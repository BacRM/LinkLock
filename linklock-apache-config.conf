# --- CONFIGURATION PRODUCTION LINKLOCK.SMART-BTP.COM ---
# Apache VirtualHost pour HTTPS (port 443)

<VirtualHost *:443>
    ServerName linklock.smart-btp.com
    ServerAlias www.linklock.smart-btp.com

    # SSL Configuration
    SSLEngine on
    SSLCertificateFile /etc/ssl/certs/linklock.smart-btp.com.crt
    SSLCertificateKeyFile /etc/ssl/private/linklock.smart-btp.com.key
    SSLCertificateChainFile /etc/ssl/certs/linklock.smart-btp.com.ca-bundle

    # Racine du projet (build frontend)
    DocumentRoot /var/www/vhosts/smart-btp.com/linklock.smart-btp.com
    <Directory /var/www/vhosts/smart-btp.com/linklock.smart-btp.com>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

    # Headers de sécurité
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-XSS-Protection "1; mode=block"

    # Proxy pour l'API backend (port 8085) - AVANT le proxy frontend
    ProxyPass /api http://127.0.0.1:8085/api
    ProxyPassReverse /api http://127.0.0.1:8085/api

    # Headers essentiels
    ProxyPreserveHost On
    ProxyRequests Off
    RequestHeader set X-Forwarded-Proto "https"
    RequestHeader set X-Forwarded-Host "%{HTTP_HOST}e"

    # Timeouts
    ProxyTimeout 60

    # Logging
    ErrorLog ${APACHE_LOG_DIR}/linklock-error.log
    CustomLog ${APACHE_LOG_DIR}/linklock-access.log combined
</VirtualHost>

# Redirection HTTP vers HTTPS (port 80)
<VirtualHost *:80>
    ServerName linklock.smart-btp.com
    ServerAlias www.linklock.smart-btp.com

    Redirect permanent / https://linklock.smart-btp.com/

    ErrorLog ${APACHE_LOG_DIR}/linklock-error.log
    CustomLog ${APACHE_LOG_DIR}/linklock-access.log combined
</VirtualHost>
